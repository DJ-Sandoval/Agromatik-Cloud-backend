package com.agromatik.cloud.rules

import com.agromatik.cloud.domain.enums.Severity
import com.agromatik.cloud.infrastructure.web.dto.SensorDataDTO
import com.agromatik.cloud.infrastructure.message.AlertService

global AlertService alertService

rule "Temperatura crítica alta"
    when
        $data : SensorDataDTO(type == "TEMPERATURE", value > 35)
    then
        alertService.sendAlert("Temperatura crítica", "Temperatura muy alta: " + $data.getValue(), Severity.CRITICAL.name());
end

rule "Humedad baja prolongada"
    when
        $data : SensorDataDTO(type == "HUMIDITY", value < 30)
    then
        alertService.sendAlert("Humedad baja", "Humedad muy baja: " + $data.getValue(), Severity.WARNING.name());
end

rule "Estrés hídrico en etapa crítica"
    when
        $data : SensorDataDTO(type == "HUMIDITY", value < 40)
        // Podemos agregar más condiciones como etapa de crecimiento
    then
        alertService.sendAlert("Estrés hídrico", "Posible estrés hídrico detectado", Severity.WARNING.name());
end